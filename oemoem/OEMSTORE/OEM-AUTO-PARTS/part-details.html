<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Part Details</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sofia+Sans+Extra+Condensed:ital,wght@0,400;0,600;0,800;1,800&display=swap" rel="stylesheet">
  <style>
      :root {
          --racing-red: #e63946;
          --deep-black: #1a1a1a;
          --chrome-silver: #c5c6c7;
          --steel-blue: #457b9d;
          --white: #ffffff;
          --shadow: rgba(26, 26, 26, 0.2);
          --accent-orange: #ff6b35;
      }
      
      * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
      }
      
      body { 
          font-family: "Sofia Sans Extra Condensed", sans-serif; 
          background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
          color: var(--deep-black);
          min-height: 100vh;
      }

      .nav { 
          background: linear-gradient(135deg, var(--deep-black) 0%, #2d3436 100%);
          padding: 0;
          box-shadow: 0 4px 20px var(--shadow);
          position: sticky;
          top: 0;
          z-index: 100;
          border-bottom: 3px solid var(--racing-red);
      }

      .nav-container {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px 20px;
      }

      .nav-brand {
          display: flex;
          align-items: center;
      }

      .brand-logo {
          display: flex;
          align-items: center;
          gap: 15px;
      }

      .brand-text {
          display: flex;
          flex-direction: column;
          line-height: 1.2;
      }

      .brand-name {
          font-size: 1.4rem;
          font-weight: 800;
          color: var(--white);
          letter-spacing: 1px;
      }

      .brand-tagline {
          font-size: 0.7rem;
          color: var(--chrome-silver);
          text-transform: uppercase;
          letter-spacing: 1.5px;
          margin-top: 2px;
      }

      .nav-links {
          display: flex;
          align-items: center;
          gap: 30px;
      }

      .nav-link {
          color: var(--white);
          text-decoration: none;
          padding: 10px 20px;
          border-radius: 30px;
          font-weight: 600;
          font-size: 1rem;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
          position: relative;
      }

      .nav-link:hover {
          background: linear-gradient(135deg, var(--racing-red) 0%, var(--accent-orange) 100%);
          color: var(--white);
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(230, 57, 70, 0.4);
      }

      .cart-link {
          background: linear-gradient(135deg, var(--steel-blue) 0%, var(--racing-red) 100%);
          font-weight: 700;
      }

      .cart-link:hover {
          background: linear-gradient(135deg, var(--racing-red) 0%, var(--accent-orange) 100%);
          transform: translateY(-3px) scale(1.05);
      }
      
      .container { 
          max-width: 1200px;
          margin: 0 auto;
          padding: 40px 20px;
          text-align: center;
      }
      
      h1 {
          font-size: 2.5rem;
          font-weight: 800;
          color: var(--deep-black);
          margin-bottom: 20px;
          text-shadow: 2px 2px 4px var(--shadow);
      }
      
      p {
          font-size: 1.2rem;
          margin-bottom: 30px;
          color: var(--deep-black);
          opacity: 0.8;
      }
      
      .slideshow-container { 
          position: relative; 
          width: 500px; 
          height: 400px; 
          margin: 30px auto; 
          overflow: hidden; 
          border: 2px solid var(--steel-blue); 
          border-radius: 15px;
          display: flex; 
          justify-content: center; 
          align-items: center; 
          background: var(--white);
          box-shadow: 0 8px 25px var(--shadow);
      }
      
      .magnify-container {
          position: relative;
          width: 100%;
          height: 100%;
          overflow: hidden;
      }
      
      .magnify-container img {
          width: 100%;
          height: 100%;
          object-fit: contain;
          transition: transform 0.3s ease-in-out;
      }
      
      .prev, .next { 
          cursor: pointer; 
          position: absolute; 
          top: 50%; 
          transform: translateY(-50%); 
          background: var(--racing-red);
          color: var(--white); 
          padding: 15px; 
          border: none; 
          z-index: 10;
          border-radius: 50%;
          font-size: 1.2rem;
          transition: all 0.3s ease;
      }
      
      .prev:hover, .next:hover {
          background: var(--accent-orange);
          color: var(--white);
          transform: translateY(-50%) scale(1.1);
      }
      
      .prev { left: 10px; }
      .next { right: 10px; }
      
      .details-table { 
          width: 100%; 
          max-width: 800px; 
          margin: 40px auto; 
          border-collapse: collapse; 
          text-align: left; 
          background: var(--white);
          border-radius: 15px;
          overflow: hidden;
          box-shadow: 0 8px 25px var(--shadow);
      }
      
      .details-table th, .details-table td { 
          border: 1px solid var(--chrome-silver); 
          padding: 15px; 
          font-size: 1.1rem;
      }
      
      .details-table th { 
          background: var(--steel-blue);
          color: var(--white);
          font-weight: 600;
      }
      
      .details-table td {
          background: var(--white);
      }
      
      .back-button { 
          margin-top: 30px; 
      }
      
      .back-button button, .add-to-cart {
          background: var(--racing-red);
          color: var(--white);
          border: none;
          padding: 15px 30px;
          margin: 10px;
          border-radius: 50px;
          font-size: 1.1rem;
          font-weight: 600;
          font-family: inherit;
          cursor: pointer;
          transition: all 0.3s ease;
      }
      
      .back-button button:hover, .add-to-cart:hover {
          background: var(--accent-orange);
          color: var(--white);
          transform: translateY(-2px);
          box-shadow: 0 5px 15px var(--shadow);
      }
      
      @media (max-width: 768px) {
          .container {
              padding: 20px 15px;
              text-align: center;
          }
          
          h1 {
              font-size: 2rem;
          }
          
          p {
              font-size: 1.1rem;
          }

          .nav-container {
              flex-direction: column;
              gap: 15px;
              padding: 15px 15px;
          }

          .brand-name {
              font-size: 1.2rem;
          }

          .brand-tagline {
              font-size: 0.6rem;
          }

          .nav-links {
              flex-wrap: wrap;
              justify-content: center;
              gap: 15px;
          }

          .nav-link {
              padding: 8px 15px;
              font-size: 0.9rem;
          }
          
          .slideshow-container {
              width: 95%;
              height: 280px;
              margin: 20px auto;
          }
          
          .prev, .next {
              padding: 12px;
              font-size: 1rem;
          }
          
          .details-table {
              font-size: 0.9rem;
          }
          
          .details-table th, .details-table td {
              padding: 10px 8px;
              font-size: 0.9rem;
          }
          
          .add-to-cart, .back-button button {
              font-size: 16px; /* Prevents zoom on iOS */
              padding: 12px 25px;
              margin: 8px;
          }
      }
      
      @media (max-width: 480px) {
          .container {
              padding: 15px 10px;
          }
          
          h1 {
              font-size: 1.6rem;
              margin-bottom: 15px;
              line-height: 1.2;
          }
          
          p {
              font-size: 1rem;
              margin-bottom: 20px;
          }
          
          .slideshow-container {
              width: 100%;
              height: 220px;
              margin: 15px auto;
          }
          
          .prev, .next {
              padding: 8px;
              font-size: 0.9rem;
              width: 35px;
              height: 35px;
          }
          
          .prev { left: 5px; }
          .next { right: 5px; }
          
          .details-table {
              margin: 25px auto;
              border-radius: 10px;
          }
          
          .details-table th, .details-table td {
              padding: 8px 6px;
              font-size: 0.8rem;
              line-height: 1.3;
          }
          
          .details-table th {
              font-size: 0.75rem;
              font-weight: 700;
          }
          
          .add-to-cart, .back-button button {
              width: 100%;
              margin: 8px 0;
              padding: 12px 20px;
              font-size: 14px;
              border-radius: 25px;
          }
          
          .back-button {
              margin-top: 20px;
          }
      }
  </style>
</head>
<body>
  <div class="nav">
      <div class="nav-container">
          <div class="nav-brand">
              <div class="brand-logo">
                  <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="20" cy="20" r="18" stroke="#e63946" stroke-width="2" fill="none"/>
                      <circle cx="20" cy="20" r="12" stroke="#e63946" stroke-width="1.5" fill="none"/>
                      <circle cx="20" cy="20" r="6" fill="#e63946"/>
                      <rect x="18" y="8" width="4" height="6" fill="#e63946" rx="2"/>
                      <rect x="18" y="26" width="4" height="6" fill="#e63946" rx="2"/>
                      <rect x="8" y="18" width="6" height="4" fill="#e63946" rx="2"/>
                      <rect x="26" y="18" width="6" height="4" fill="#e63946" rx="2"/>
                  </svg>
                  <div class="brand-text">
                      <span class="brand-name">OEM AUTO PARTS</span>
                      <span class="brand-tagline">Quality • Authentic • Reliable</span>
                  </div>
              </div>
          </div>
          <div class="nav-links">
              <a href="index.html" class="nav-link">Home</a>
              <a href="parts_inventory.html" class="nav-link">Parts Inventory</a>
              <a href="reviews.html" class="nav-link">Reviews</a>
              <a href="contact.html" class="nav-link">Contact</a>
              <a href="profile.html" class="nav-link">Profile</a>
              <a href="cart.html" class="nav-link cart-link">
                  Cart (<span id="cart-count">0</span>)
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M3 1h1.5l.3 1.2h12.4c.5 0 .8.4.8.8 0 .1 0 .2-.1.3l-2.5 5c-.2.4-.6.7-1.1.7H7.1l-.3 1.2h9.4c.4 0 .8.4.8.8s-.4.8-.8.8H6c-.3 0-.6-.2-.7-.5L3.1 2H2c-.4 0-.8-.4-.8-.8S1.6 1 2 1h1zm5 14c.8 0 1.5.7 1.5 1.5S8.8 18 8 18s-1.5-.7-1.5-1.5S7.2 15 8 15zm8 0c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5z"/>
                  </svg>
              </a>
          </div>
      </div>
  </div>

  <div class="container">
    <h1 id="part-title"></h1>
    <p id="part-price"></p>
    <div class="slideshow-container">
      <div class="magnify-container" id="magnify-container">
        <img id="magnify-image" src="" alt="Zoom Image">
      </div>
      <button class="prev" onclick="changeSlide(-1)">&#10094;</button>
      <button class="next" onclick="changeSlide(1)">&#10095;</button>
    </div>
    <p id="part-description"></p>
    
    <!-- Extra details table -->
    <table class="details-table" id="part-extra-details">
      <!-- Table rows inserted via JavaScript -->
    </table>

    <button class="add-to-cart" onclick="addToCart()">Add to Cart</button>
    <div class="back-button">
      <button onclick="goBack()">Back to Inventory</button>
    </div>
  </div>

  <script>
    let currentSlideIndex = 0;
    let slides = [];
    let zoomTimeout;

    function loadPartDetails() {
      const partDetails = JSON.parse(localStorage.getItem('partDetails'));
      if (!partDetails) {
        alert("No part details found!");
        window.location.href = 'parts_inventory.html';
        return;
      }
      // Decode the stored values
      const title = decodeURIComponent(partDetails.title);
      const price = decodeURIComponent(partDetails.price);
      const description = decodeURIComponent(partDetails.description);
      
      document.getElementById("part-title").innerText = title;
      document.getElementById("part-price").innerText = `Price: $${price}`;
      document.getElementById("part-description").innerText = description;

      // Process images: if a string, decode and split by pipe delimiter
      let imagesRaw = partDetails.images;
      if (typeof imagesRaw === "string") {
        imagesRaw = decodeURIComponent(imagesRaw);
        slides = imagesRaw.includes('|') ? imagesRaw.split(/\s*\|\s*/) : [imagesRaw];
      } else if (Array.isArray(imagesRaw)) {
        slides = imagesRaw;
      } else {
        slides = [];
      }
      slides = slides.map(url => url.trim()).filter(url => url !== "");
      if (slides.length > 0) {
        document.getElementById("magnify-image").src = slides[0];
      } else {
        document.getElementById("magnify-image").src = "";
        document.getElementById("magnify-image").alt = "No image available";
      }

      renderExtraDetails(partDetails);
    }

    function renderExtraDetails(details) {
      const fields = [
        { label: "Part Number", key: "Part Number" },
        { label: "Car Brand", key: "Car Brand" },
        { label: "Manufacturer Part Number", key: "Manufacturer Part Number" },
        { label: "Year", key: "Year" },
        { label: "Car Model", key: "Car Model" },
        { label: "Stock Number", key: "Stock Number" },
        { label: "VIN Number", key: "VIN Number" },
        { label: "*Category", key: "*Category" },
        { label: "*ConditionID", key: "*ConditionID" },
        { label: "*Format", key: "*Format" },
        { label: "*Duration", key: "*Duration" },
        { label: "*StartPrice", key: "*StartPrice" },
        { label: "*Location", key: "*Location" },
        { label: "ShippingType", key: "ShippingType" },
        { label: "ShippingService-1:Option", key: "ShippingService-1:Option" },
        { label: "ShippingService-1:Cost", key: "ShippingService-1:Cost" },
        { label: "*DispatchTimeMax", key: "*DispatchTimeMax" },
        { label: "*ReturnsAcceptedOption", key: "*ReturnsAcceptedOption" },
        { label: "Compatibilities", key: "Compatibilities" }
      ];

      let tableHTML = "";
      fields.forEach(field => {
        if (details[field.key]) {
          // Decode each field for display
          tableHTML += `<tr><th>${field.label}</th><td>${decodeURIComponent(details[field.key])}</td></tr>`;
        }
      });
      document.getElementById("part-extra-details").innerHTML = tableHTML;
    }

    function changeSlide(direction) {
      if (slides.length === 0) return;
      currentSlideIndex = (currentSlideIndex + direction + slides.length) % slides.length;
      document.getElementById("magnify-image").src = slides[currentSlideIndex];
    }

    function addToCart() {
      const partDetails = JSON.parse(localStorage.getItem('partDetails'));
      if (!partDetails) {
        alert("Error loading part details!");
        return;
      }
      
      let cart = [];
      const savedCart = localStorage.getItem('autoPartsCart');
      if (savedCart) {
        cart = JSON.parse(savedCart);
      }
      
      const cartItem = {
        title: decodeURIComponent(partDetails.title),
        price: parseFloat(decodeURIComponent(partDetails.price)),
        images: typeof partDetails.images === 'string' ? decodeURIComponent(partDetails.images) : partDetails.images.join('|'),
        partNumber: decodeURIComponent(partDetails["Part Number"] || 'N/A'),
        description: decodeURIComponent(partDetails.description || '')
      };
      
      const existingItem = cart.find(item => item.partNumber === cartItem.partNumber);
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          ...cartItem,
          quantity: 1
        });
      }
      
      localStorage.setItem('autoPartsCart', JSON.stringify(cart));
      updateCartCount();
      
      // Show feedback
      const button = document.querySelector('.add-to-cart');
      const originalText = button.textContent;
      button.textContent = 'Added to Cart!';
      button.style.background = '#27ae60';
      setTimeout(() => {
        button.textContent = originalText;
        button.style.background = '';
      }, 2000);
    }

    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('autoPartsCart') || '[]');
      const count = cart.reduce((total, item) => total + item.quantity, 0);
      const cartCountElement = document.querySelector('#cart-count');
      if (cartCountElement) {
        cartCountElement.textContent = count;
      }
    }

    function goBack() {
      window.location.href = 'parts_inventory.html';
    }

    document.getElementById("magnify-container").addEventListener("mouseenter", function () {
      zoomTimeout = setTimeout(() => {
        document.getElementById("magnify-image").style.transform = "scale(1.3)";
      }, 5000);
    });

    document.getElementById("magnify-container").addEventListener("mouseleave", function () {
      clearTimeout(zoomTimeout);
      document.getElementById("magnify-image").style.transform = "scale(1)";
    });

    window.onload = () => {
      loadPartDetails();
      updateCartCount();
    };
  </script>
</body>
</html>
